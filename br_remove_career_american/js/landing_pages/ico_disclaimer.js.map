{"version":3,"sources":["../../../../src/javascript/landing_pages/ico_disclaimer.js"],"names":["el_residence_list","window","onload","frm_select_residence","document","getElementById","frm_accept_disclaimer","frm_accept_second_notice","getWebsocketData","msg_type","req","residence_list","ico_status","JSON","parse","sessionStorage","getItem","populateResidenceList","isRestrictedCountry","val","restricted_countries","ico_countries_config","restricted","indexOf","country_names","code","name","showSecondNotice","country_name","map","item","idx","el_country_name","appendChild","createTextNode","notice_msg","classList","remove","el","showDisclaimer","test","access_denied_msg","disclaimer_msg","hideForm","parentNode","add","addEventListener","e","preventDefault","checked","url","location","href","form","validation_set","value","validateResidence","evt","commonOnload","el_error","getElementsByClassName","requests","done","filter","r","length","setTimeout","sendRequests","forEach","wsSend","ws","wsConnect","readyState","onopen","onmessage","msg","response","data","setSession","stringify","close","res","el_option","createElement","text","loading","disclaimer_form"],"mappings":"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","file":"ico_disclaimer.js","sourcesContent":["var el_residence_list;\nwindow.onload = function() {\n    var frm_select_residence     = document.getElementById('frm_select_residence');\n    var frm_accept_disclaimer    = document.getElementById('frm_accept_disclaimer');\n    var frm_accept_second_notice = document.getElementById('frm_accept_second_notice');\n    el_residence_list            = document.getElementById('residence_list');\n\n    getWebsocketData([\n        { msg_type: 'residence_list', req: { residence_list: 1 } },\n        { msg_type: 'ico_status', req: { ico_status: 1 } },\n    ], function() {\n        var residence_list = JSON.parse(sessionStorage.getItem('residence_list') || null);\n        populateResidenceList(residence_list);\n    });\n\n    function isRestrictedCountry(val) {\n        var ico_status = JSON.parse(sessionStorage.getItem('ico_status') || null);\n        const restricted_countries = ico_status.ico_countries_config.restricted;\n\n        return restricted_countries.indexOf(val) !== -1;\n    }\n\n    var country_names = [\n        { code: 'gb', name: 'the United Kingdom' },\n        { code: 'eu', name: 'the European Economic Area' },\n        { code: 'hk', name: 'Hong Kong' },\n        { code: 'jp', name: 'Japan' },\n    ]\n\n    function showSecondNotice(val) {\n        var country_name;\n        country_names.map(function(item, idx) {\n            if (item.code === val) {\n                country_name = item.name;\n            }\n        });\n        var el_country_name = document.getElementById('country_name');\n        if (el_country_name) el_country_name.appendChild(document.createTextNode(country_name));\n        var notice_msg = document.getElementById('notice_msg');\n        if (notice_msg) notice_msg.classList.remove('invisible');\n        var el = document.getElementById(val);\n        if (el) el.classList.remove('invisible');\n    }\n\n    function showDisclaimer(val) {\n        if (isRestrictedCountry(val)) {\n            // eu countries code\n            if (/^(al|ad|at|by|be|ba|bg|hr|cy|cz|dk|ee|fo|fi|fr|de|gi|gr|hu|is|ie|im|it|ru|lv|li|lt|lu|mk|mt|md|mc|me|nl|no|pl|pt|ro|sm|sk|si|es|se|ch|ua|va)$/.test(val)) {\n                val = 'eu';\n            }\n\n            if (/^(ca|jp|sg|hk|gb|ch|eu)$/.test(val)) {\n                showSecondNotice(val);\n            } else {\n                var access_denied_msg = document.getElementById('access_denied_msg');\n                if (access_denied_msg) access_denied_msg.classList.remove('invisible');\n            }\n        } else {\n            var disclaimer_msg = document.getElementById('disclaimer_msg');\n            if (disclaimer_msg) disclaimer_msg.classList.remove('invisible');\n        }\n    }\n\n    function hideForm() {\n        frm_select_residence.parentNode.classList.add('invisible');\n    }\n\n    frm_accept_disclaimer.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var val = (document.getElementById('checkbox') || '').checked; // true or false\n        var url = 'https://ico_documents.binary.com/im.pdf';\n        if (val) {\n            window.location.href = url;\n        } else {\n            var form = document.getElementById('frm_accept_disclaimer_error');\n            if (form) form.classList.remove('invisible');\n        }\n    });\n\n    var validation_set = false; // To prevent validating before submit\n\n    frm_select_residence.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var val = (document.getElementById('residence_list') || '').value;\n        if (!validateResidence(this)) {\n            if (!validation_set) {\n                this.addEventListener('change', function (evt) {\n                    evt.preventDefault();\n                    validateResidence(this);\n                    validation_set = true;\n                })\n            }\n            return false;\n        }\n        hideForm();\n        showDisclaimer(val);\n    });\n\n    frm_accept_second_notice.addEventListener('submit', function(e) {\n        e.preventDefault();\n        var val = (document.getElementById('checkbox-2') || '').checked; // true or false\n        if (val) {\n            var notice_msg = document.getElementById('notice_msg');\n            if (notice_msg) notice_msg.classList.add('invisible');\n            showDisclaimer(val);\n        } else {\n            var form = document.getElementById('frm_accept_notice_error');\n            if (form) form.classList.remove('invisible');\n        }\n    });\n\n    commonOnload();\n};\n\nfunction validateResidence(el) {\n    var val      = (document.getElementById('residence_list') || '').value;\n    var el_error = el.getElementsByClassName('error-msg')[0];\n    if (val === '0') {\n        el_error.classList.remove('invisible');\n        return false;\n    }\n    el_error.classList.add('invisible');\n    return true;\n}\n\nfunction getWebsocketData(requests, done) {\n    requests = requests.filter(r => !sessionStorage.getItem(r.msg_type));\n\n    if(!requests.length) {\n        setTimeout(done, 0);\n        return;\n    }\n\n    function sendRequests() {\n        requests.forEach(function(r) {\n            wsSend(ws, r.req);\n        })\n    }\n\n    var ws = wsConnect();\n    if (ws.readyState === 1) {\n        sendRequests();\n    } else {\n        ws.onopen = sendRequests;\n    }\n\n    ws.onmessage = function (msg) {\n        var response = JSON.parse(msg.data);\n\n        var msg_type = response.msg_type;\n        setSession(msg_type, JSON.stringify(response[msg_type]));\n        requests = requests.filter(function(r) { return r.msg_type !== msg_type; });\n\n        if (!requests.length) {\n            setTimeout(done, 0);\n            ws.close();\n            return;\n        }\n    }\n}\n\nfunction populateResidenceList(residence_list) {\n    residence_list.forEach(function(res) {\n        var el_option = document.createElement('option');\n        el_option.text  = res.text;\n        el_option.value = res.value;\n        el_residence_list.appendChild(el_option);\n    });\n    var loading = document.getElementById('loading');\n    if (loading) loading.classList.add('invisible');\n    var disclaimer_form = document.getElementById('disclaimer_form');\n    if (disclaimer_form) disclaimer_form.classList.remove('invisible');\n}\n"]}